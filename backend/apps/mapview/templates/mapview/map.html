{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load l10n %}

{% block title %}
{% blocktrans %}Karte der Angebote{% endblocktrans %}
{% endblock %}

{% block header %}

<link rel="stylesheet" href="{% static 'js/leaflet-1.6.0/leaflet.css' %}" />
<link rel="stylesheet" href="{% static 'js/leaflet.markercluster-1.4.1/MarkerCluster.css' %}" />
<link rel="stylesheet" href="{% static 'js/leaflet.markercluster-1.4.1/MarkerCluster.Default.css' %}" />
<link rel="stylesheet" href="{% static 'css/map.css' %}">

<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="{% static 'js/leaflet-1.6.0/leaflet.js' %}" ></script>
<script src="{% static 'js/leaflet.markercluster-1.4.1/leaflet.markercluster.js' %}" ></script>
<script src="{% static 'js/Leaflet.FeatureGroup.SubGroup-1.0.2/leaflet.featuregroup.subgroup.js' %}" ></script>

<style>.footer { margin-top:0px !important; }
p.listview { margin-top: 25px;
    position: absolute;
    bottom: 20px;
    z-index: 900;
    text-align: center;
    width: 100%;}
    div.leaflet-top.leaflet-right { width: 100%; }
    .leaflet-top .leaflet-control { margin-top: 0px; margin-right: 0px; border-radius: 0px; width: 100%;}
    .icon svg { margin-top: -2px; margin-right: 5px;}

    p.listview a {    color: #fff !important; }
h4.popup-title { font-size: 16px; margin-top: 10px;}
    div.content { position: relative; }
    .leaflet-popup-content { padding-bottom: 10px; min-width: 180px;}
    .btn { color: #fff !important; background-color: #fa5103; border-radius: 10px; font-size: 14px;}
</style>
<script type="text/javascript">

  pageOptions = {
    mapViewContainerId: 'mapContainer',
    accomodationOfferURL     : "{% url 'accomodationOffersJSON' %}",
    transportationOfferURL     : "{% url 'transportationOffersJSON' %}",
    translationOfferURL     : "{% url 'translationOffersJSON' %}",
    genericOfferURL     : "{% url 'genericOffersJSON' %}",
    mapboxToken       : "{{ mapbox_token }}",
    createPopupTextTranslation  :  (countrycode,city, plz, count, url) => `{% blocktrans %}In ${city}, (PLZ ${plz}) gibt es ${count} Logistikangebote. \n<br><a href="/offers/by_postCode/${plz}" target="_blank">Detailansicht</a>{% endblocktrans %}`,
    createPopupTextGeneric  :  (countrycode,city, plz, count, url) => `{% blocktrans %}In ${city}, (PLZ ${plz}) gibt es ${count} Angebote. \n<br><a href="/offers/by_postCode/${plz}" target="_blank">Detailansicht</a>{% endblocktrans %}`,
    createPopupTextTransportation  :  (countrycode,city, plz, count, url) => `{% blocktrans %}In ${city}, (PLZ ${plz}) gibt es ${count} Übersetzungen. \n<a href="/offers/by_postCode/${plz}" target="_blank">Detailansicht</a>{% endblocktrans %}`,
    createPopupTextAccomodation :  (countrycode,city, plz, count, url) => `<div style="margin-left: -19px; margin-right:-19px; margin-top:-13px;"><img src="{% static 'img/offers/no-acc-img.jpg' %}" style="border-radius: 15px; width: 100%;" width="200px" height="auto"></div><h4 class="popup-title">3-room flat</h4><p class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
    <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816zM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275zM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/>
  </svg> {{entry.offer.numberOfInhabitants}} people</p>
<p class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar" viewBox="0 0 16 16">
    <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
  </svg> {{entry.offer.stayLength}} days</p>
<p class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/>
    <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/>
  </svg> Entire apartment</p> \n<p style="padding-top: 5px;"><a href="/offers/by_postCode/${plz}" target="_blank" class="btn">{% blocktrans %} Mehr dazu{% endblocktrans %}</a></p>`,
    createAccomodationCountText: (count) => `<img src="{% static 'img/map/housing.svg' %}"> ${count} {% trans "Unterbringungs-Angebote" %}`,
    createTransportationCountText: (count) => `<img src="{% static 'img/map/transport.svg' %}"> ${count} {% trans "Logistik-Angebote" %}`,
    createTranslationCountText: (count) => `<img src="{% static 'img/map/translation.svg' %}"> ${count} {% trans "Übersetzungs-Angebote" %}`,
    createDigitalCountText: (count) => `<img src="{% static 'img/map/digital-marker.svg' %}"> ${count} {% trans "Digitale Angebote" %}`,
    createGenericCountText: (count) => `<img src="{% static 'img/map/generic-marker.svg' %}"> ${count} {% trans "Angebote" %}`,

    facilityIcon: L.icon({
      iconUrl: "{% static 'img/map/facility-marker.svg' %}",
      iconSize: [40, 40],
    }),
  }
</script>
<!--<script type="text/javascript" src="mapview/?accomodation=False&translation=False&transportation=False&generic=True"></script> -->
<script type="text/javascript" src="mapview/?accomodation={{ accomodation }}&translation={{ translation }}&transportation={{ transportation }}&generic={{ generic }}"></script> 
  

{% endblock %}

{% block content %}
  {% if user.is_authenticated and user.isOrganisation %}
<nav class="navbar navbar-expand-sm navbar-dark bg-light search-map" id="organisation_navbar">
  <div class="container">
    <div class="order-0">
      <select name="countrycode" id="countrycode" class="map-dropdown">
        <option value="DE">{% blocktrans %}Deutschland{% endblocktrans %}</option>
        <option value="AT">{% blocktrans %}Österreich{% endblocktrans %}</option>
      </select>
      <input type="text" id="search" class="form textinput textInput map-input" placeholder="Postleitzahl">
      <button class="btn btn-primary btn blue text-white btn-md" role="button" onclick="gototable()">{% blocktrans %}Direktsuche{% endblocktrans %} &raquo;</button>
    </div>
  </div>
</nav>
{% endif %}

<div id="mapContainer" style="z-index:1;">
	 <a href="http://mapbox.com/about/maps" class="mapbox-wordmark" target="_blank">Mapbox</a>
   <p class="listview">
    <a href="#" class="btn btn-yellow" role="button" aria-pressed="true"
    > <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16" style="margin-right: 10px; margin-top:-2px;">
      <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
    </svg> Show 43 results as list
  </a></p>
</div>

<script type="text/javascript">
  var gototable = function() {
      if ($('#search').val()) {
        window.location = "/iamorganisation/helpers/" + $('#countrycode').val() + "/" + $('#search').val() + "/0"
      }
    };
  $("#search").keyup(function(event) {
      if (event.keyCode === 13) {
          gototable();
      }
  });
</script>

{% endblock %}
