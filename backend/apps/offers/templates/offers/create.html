{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block header %}
<link rel="stylesheet" href="{% static 'css/form.css' %}">
{% endblock %}

{% block content %}
<form action="/offers/create" method="post">
    {% csrf_token %}
    <table id="mainTable">
        <tbody>
            {% for field in genericForm.visible_fields %}
            <tr>
                <td >{{ field.label_tag }}</td> <td id="{{ field.name }}">{{field }}</td>   
            </tr>
            {% endfor %}
        </tbody>
        <tbody id="acTable">
            {% for field in accomodationForm.visible_fields %}
            <tr>        
                <td>{{ field.label_tag }}</td> <td>{{field }}</td>   
            </tr>
            {% endfor %}
        </tbody>
        <tbody  id="trTable">
            {% for field in transportationForm.visible_fields %}
            <tr>  
                <td>{{ field.label_tag }}</td> <td>{{field }}</td>   
            </tr>
            {% endfor %}
        </tbody>
        <tbody id="tlTable">
            {% for field in translationForm.visible_fields %}
            <tr>    
                <td>{{ field.label_tag }}</td> <td>{{field }}</td>   
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <input type="submit" value="Submit">
</form>
<script>
    var typeSelection = "AC"
    var tlTable = document.getElementById("tlTable")
    var trTable = document.getElementById("trTable")
    var acTable = document.getElementById("acTable")
    refresh()
    markEntries()
    function markEntries(){
        var table = document.getElementById("mainTable")
        var entries = table.querySelectorAll("[required]")
        for(var i = 0; i < entries.length; i++){
            var entry = entries[i]
            entry.setAttribute("wasRequired", "true") 

        }
    }
    function toggleRequiredTag(subtable, state){
            console.log(subtable.id+" to "+state)
        if (state == false ){
            subtable.style.visibility = "collapse"
            var entries = subtable.querySelectorAll("[required]")
            for (var i = 0; i < entries.length; i ++){
                var entry = entries[i]
                entry.required = false

            }
        }
        else {
            subtable.style.visibility = "visible"
            var entries = subtable.querySelectorAll("[wasRequired]")
            for (var i = 0; i < entries.length; i ++){
                var entry = entries[i]
                entry.required = true

            }
        }
    }
    function refresh(){
        typeSelection = document.getElementsByName("offerType")[0].value
        if (typeSelection == "AC"){
            // Show only Accomodation Table

            toggleRequiredTag(tlTable, false)
            toggleRequiredTag(acTable, true)
            toggleRequiredTag(trTable, false)
            // Mark all invisible fields as "nonrequired":
           
        }
        else if (typeSelection == "TR"){
            // Show only Transportation Table
            // Toggle AC and TL Table values...
            toggleRequiredTag(tlTable, false)
            toggleRequiredTag(acTable, false)
            toggleRequiredTag(trTable, true)
            
        }
        else if (typeSelection == "TL"){
            // Show only Translation Table
            toggleRequiredTag(tlTable, true)
            toggleRequiredTag(acTable, false)
            toggleRequiredTag(trTable, false)
        }
}
</script>
{% endblock %}