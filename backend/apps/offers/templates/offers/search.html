{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}
{% blocktrans %}Listenansicht Angebote{% endblocktrans %}{% endblock %}

{% block header %}
<style>
  div.description { padding: 10px; position: relative; }
  .count { text-align: right; }
.count p { display: inline; margin-bottom: 0px !important; padding:5px; border-radius: 5px; background-color: #f5980f; color: #fff;  }
div.background-photo-search {  border-radius: 20px; padding-top: 100%;  max-width: 100%; background-size: cover;}
.pointer { cursor: pointer; }
@media only screen and (max-width: 767px) { div.background-photo-search {padding-top: 80%;max-width: 100%;  }   }
</style>
{% endblock %}

{% block content %}

<div class="container">
    <div style="height:40px"></div>
    <div class="row align-self-center align-items-center top-menu">
<div class="col-6 left">
 <p class="font-weight-bold">  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"  style="margin-top: -2px;" class="bi bi-chevron-left" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
      </svg> <a href="#">{% blocktrans %}Zurück{% endblocktrans %}</a> </p></div>
    <div class="col-6 filter">
        <p><a href="#">{% blocktrans %}Filter{% endblocktrans %}</a></p></div>
        </div>

        <div class="row align-self-center align-items-center">
<div class="col-lg-12">
<form action="/offers/search">
    <div style="position: relative">
      <input
        type="text"
        id="id_location"
        name="location"
        class="input-form-search"
        placeholder="{% blocktrans %}Berlin{% endblocktrans %}"
      >
      <input type="hidden" value="" name="lat">
      <input type="hidden" value="" name="lng">
      <input type="hidden" value="" name="bb">
      <svg
        class="bi bi-search"
        style="
          margin-left: 3px;
          position: absolute;
          top: 13px;
          left: 10px;
        "
        width="14px"
        height="14px"
        viewBox="0 0 18 14"
        fill="#495057"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill-rule="evenodd"
          d="M10.442 10.442a1 1 0 011.415 0l3.85 3.85a1 1 0 01-1.414 1.415l-3.85-3.85a1 1 0 010-1.415z"
          clip-rule="evenodd"
        />
        <path
          fill-rule="evenodd"
          d="M6.5 12a5.5 5.5 0 100-11 5.5 5.5 0 000 11zM13 6.5a6.5 6.5 0 11-13 0 6.5 6.5 0 0113 0z"
          clip-rule="evenodd"
        />
      </svg>
    </div>
    
    <input id="searchsubmit" type="button"  onclick="triggerGoogleSearch()" />
  </form>

</div></div> 

<div style="{% if  city == None or city == ""%} display:none{%endif%} ">
    <div class="row align-self-center align-items-center" style="margin-top:35px;">
 <div class="col-12 text-center" style="text-align:center;" >
    <h2 class="title" >{% blocktrans %}Welche Art von Hilfe benötigst du?{% endblocktrans %}</h2><p>{% blocktrans %}Wähle eine Kategorie, um Angebote in {{ city }} anzuzeigen.{% endblocktrans %}</p></div>
        </div>
        </div>
        <div class="container cards" style="{% if  city == None or city == "" %} display:none{%endif%} ">
            <a onclick="search_offers(['accommodation']);" class="pointer">        
            <div class="col-12 col-lg-6 offer-card"> 

                <div class="row align-self-center align-items-center">
                <div class="col-4 col-sm-2" style="padding: 5px;">
             
                    <div class="background-photo-search" style="background-image: url({% static 'img/offers/accommodation.jpg' %})"></div>

                  </div>
                <div class="description col-6 col-sm-8">
<h3>{% blocktrans %}Unterkunft{% endblocktrans %}</h3>
<p>{% blocktrans %}Suche nach einer passenden Unterkunft.{% endblocktrans %}</p>

</div>
<div class="count col-2 col-sm-2">

    <p>{{ local.AccommodationOffers }}</p>
    
    </div>
                </div>

            </div>   
            </a>  
          

       
            <a onclick="search_offers(['buerocracy'])" class="pointer">        
                <div class="col-12 col-lg-6 offer-card"> 
    
                    <div class="row align-self-center align-items-center">
                    <div class="col-4 col-sm-2" style="padding: 5px;">
                 
                        <div class="background-photo-search" style="background-image: url({% static 'img/offers/buerocracy.jpg' %})"></div>
    
                      </div>
                    <div class="description col-6 col-sm-8">
    <h3>{% blocktrans %}Bürokratie{% endblocktrans %}</h3>
    <p>{% blocktrans %}z.B. Unterstützung bei Behördengängen.{% endblocktrans %}</p>
    
    </div>
    
    <div class="count col-2 col-sm-2">
    
        <p>{{ local.BuerocraticOffers }}</p>
        
        </div>
                    </div>
    
                </div>   
                </a>  


                <a onclick="search_offers(['manpower']);" class="pointer">        
                    <div class="col-12 col-lg-6 offer-card"> 
        
                        <div class="row align-self-center align-items-center">
                        <div class="col-4 col-sm-2" style="padding: 5px;">
                     
                            <div class="background-photo-search" style="background-image: url({% static 'img/offers/manpower.jpg' %})"></div>
        
                          </div>
                        <div class="description col-6 col-sm-8">
        <h3>{% blocktrans %}Manneskraft{% endblocktrans %}</h3>
        <p>{% blocktrans %}z.B. online oder Hilfe vor Ort.{% endblocktrans %}</p>
        
        </div>
        
        <div class="count col-2 col-sm-2">
        
            <p>{{ local.ManpowerOffers }}</p>
            
            </div>
                        </div>
        
                    </div>   
                    </a>  

                    <p style="margin-top: 35px; text-align: center; clear:both;">{% blocktrans %}Mehr Angebote in deiner Nähe{% endblocktrans %}</p>

         
                    <a onclick="search_offers(['childcareShort', 'childcareLong']);" class="pointer">      
                        <div class="col-12 col-lg-6 offer-card"> 
            
                            <div class="row align-self-center align-items-center">
                            <div class="col-4 col-sm-2" style="padding: 5px;">
                         
                                <div class="background-photo-search" style="background-image: url({% static 'img/offers/childcare.jpg' %})"></div>
            
                              </div>
                            <div class="description col-6 col-sm-8">
            <h3>{% blocktrans %}Kinderfürsorge{% endblocktrans %}</h3>
            <p>{% blocktrans %}z.B. Babysitting{% endblocktrans %}</p>
            
            </div>
            
            <div class="count col-2 col-sm-2">
            
                <p>{{ local.ChildcareOfferShortterm }}</p>
                
                </div>
                            </div>
            
                        </div>   
                        </a>  


                        <a onclick="search_offers(['welfare']);" class="pointer">       
                        <div class="col-12 col-lg-6 offer-card"> 
            
                            <div class="row align-self-center align-items-center">
                            <div class="col-4 col-sm-2" style="padding: 5px;">
                         
                                <div class="background-photo-search" style="background-image: url({% static 'img/offers/medical.jpg' %})"></div>
            
                              </div>
                            <div class="description col-6 col-sm-8">
            <h3>{% blocktrans %}Medizinische Unterstützung{% endblocktrans %}</h3>
            <p>{% blocktrans %}z.B. für ältere Personen oder Personen mit Behinderungen.{% endblocktrans %}</p>
            
            </div>
            
            <div class="count col-2 col-sm-2">
            
                <p>{{ local.WelfareOffers }}</p>
                
                </div>
                            </div>
            
                        </div>   
                        </a>  



                        <a onclick="search_offers(['job']);" class="pointer">         
                        <div class="col-12 col-lg-6 offer-card"> 
            
                            <div class="row align-self-center align-items-center">
                            <div class="col-4 col-sm-2" style="padding: 5px;">
                         
                                <div class="background-photo-search" style="background-image: url({% static 'img/offers/jobs.jpg' %})"></div>
            
                              </div>
                            <div class="description col-6 col-sm-8">
            <h3>{% blocktrans %}Jobs{% endblocktrans %}</h3>
            <p>{% blocktrans %}Finde einen passenden Job.{% endblocktrans %}</p>
            
            </div>
            
            <div class="count col-2 col-sm-2">
            
                <p>{{ local.JobOffers }}</p>
                
                </div>
                            </div>
            
                        </div>   
                        </a>  



                        <a onclick="search_offers(['welfare']);" class="pointer">             
                        <div class="col-12 col-lg-6 offer-card"> 
            
                            <div class="row align-self-center align-items-center">
                            <div class="col-4 col-sm-2" style="padding: 5px;">
                         
                                <div class="background-photo-search" style="background-image: url({% static 'img/offers/psychological.jpg' %})"></div>
            
                              </div>
                            <div class="description col-6 col-sm-8">
            <h3>{% blocktrans %}Psychologische Unterstützung{% endblocktrans %}</h3>
            <p>{% blocktrans %}Online oder persönlich.{% endblocktrans %}</p>
            
            </div>
            
            <div class="count col-2 col-sm-2">
            
                <p>{{ local.PsychologicalOffers }}</p>
                
                </div>
                            </div>
            
                        </div>   
                        </a>  



                        <a onclick="search_offers(['donations']);" class="pointer">      
                        <div class="col-12 col-lg-6 offer-card"> 
            
                            <div class="row align-self-center align-items-center">
                            <div class="col-4 col-sm-2" style="padding: 5px;">
                         
                                <div class="background-photo-search" style="background-image: url({% static 'img/offers/donations.jpg' %})"></div>
            
                              </div>
                            <div class="description col-6 col-sm-8">
            <h3>{% blocktrans %}Spenden{% endblocktrans %}</h3>
            <p>{% blocktrans %}Spende an Hilfsorganisationen{% endblocktrans %}</p>
            
            </div>
            
            <div class="count col-2 col-sm-2">
            
                <p>{{ local.DonationOffers }}</p>
                
                </div>
                            </div>
            
                        </div>   
                        </a>  


</div>


</div>

<script>
  function search_offers(types){
    visibles = []
    for (var i = 0; i < types.length; i++)
    {
      visibles.push(types[i]+"Visible")
    }
    data = {}
    for (var i = 0; i < visibles.length; i++)
    {
      data[visibles[i]] = "1"
    }
    data["city"] = "{{ city }}"
    console.log("Visibles: "+JSON.stringify(data))
  
    data["show_list"] = "True"
    var csrfmiddlewaretoken = '{{ csrf_token }}'
    data.show_list = "True"
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "handle_filter", true);
    xhr.setRequestHeader( "X-CSRFToken", csrfmiddlewaretoken);
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    var formBody = [];
    for (var property in data) {
      var encodedKey = encodeURIComponent(property);
      var encodedValue = encodeURIComponent(data[property]);
      formBody.push(encodedKey + "=" + encodedValue);
    }
    formBody = formBody.join("&");
    xhr.onreadystatechange = function () {
      if (xhr.readyState == 4 && xhr.status == 200) {
        document.open();
        document.write(xhr.responseText);
        document.close();
      } 
    }
    console.log("sending: "+JSON.stringify(data))
    xhr.send(formBody);
  
  
  }
  function selectFirstOnEnter(input) {  // store the original event binding function
    console.log(input)
    var _addEventListener = (input.addEventListener) ? input.addEventListener : input.attachEvent;
    function addEventListenerWrapper(type, listener) {  // Simulate a 'down arrow' keypress on hitting 'return' when no pac suggestion is selected, and then trigger the original listener.
        if (type == "keydown") { 
            var orig_listener = listener;
            listener = function(event) {
                var suggestion_selected = $(".pac-item-selected").length > 0;
                if (event.which == 13 && !suggestion_selected) { 
                    var simulated_downarrow = $.Event("keydown", {keyCode: 40, which: 40}); 
                    orig_listener.apply(input, [simulated_downarrow]); 
                }
                orig_listener.apply(input, [event]);
            };
        }
        _addEventListener.apply(input, [type, listener]); // add the modified listener
    }

    if (input.addEventListener) { 
        input.addEventListener = addEventListenerWrapper; 
    } else if (input.attachEvent) { 
        input.attachEvent = addEventListenerWrapper; 
    }
}
var input = document.getElementById("id_location")
selectFirstOnEnter(input)
</script>
{% endblock %}